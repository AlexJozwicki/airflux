!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.airflux=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){}d.prototype._events=void 0,d.prototype.listeners=function(a){if(!this._events||!this._events[a])return[];if(this._events[a].fn)return[this._events[a].fn];for(var b=0,c=this._events[a].length,d=new Array(c);c>b;b++)d[b]=this._events[a][b].fn;return d},d.prototype.emit=function(a,b,c,d,e,f){if(!this._events||!this._events[a])return!1;var g,h,i=this._events[a],j=arguments.length;if("function"==typeof i.fn){switch(i.once&&this.removeListener(a,i.fn,!0),j){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,b),!0;case 3:return i.fn.call(i.context,b,c),!0;case 4:return i.fn.call(i.context,b,c,d),!0;case 5:return i.fn.call(i.context,b,c,d,e),!0;case 6:return i.fn.call(i.context,b,c,d,e,f),!0}for(h=1,g=new Array(j-1);j>h;h++)g[h-1]=arguments[h];i.fn.apply(i.context,g)}else{var k,l=i.length;for(h=0;l>h;h++)switch(i[h].once&&this.removeListener(a,i[h].fn,!0),j){case 1:i[h].fn.call(i[h].context);break;case 2:i[h].fn.call(i[h].context,b);break;case 3:i[h].fn.call(i[h].context,b,c);break;default:if(!g)for(k=1,g=new Array(j-1);j>k;k++)g[k-1]=arguments[k];i[h].fn.apply(i[h].context,g)}}return!0},d.prototype.on=function(a,b,d){var e=new c(b,d||this);return this._events||(this._events={}),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],e]:this._events[a].push(e):this._events[a]=e,this},d.prototype.once=function(a,b,d){var e=new c(b,d||this,!0);return this._events||(this._events={}),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],e]:this._events[a].push(e):this._events[a]=e,this},d.prototype.removeListener=function(a,b,c){if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b&&(d.fn&&(d.fn!==b||c&&!d.once)&&e.push(d),!d.fn))for(var f=0,g=d.length;g>f;f++)(d[f].fn!==b||c&&!d[f].once)&&e.push(d[f]);return e.length?this._events[a]=1===e.length?e[0]:e:delete this._events[a],this},d.prototype.removeAllListeners=function(a){return this._events?(a?delete this._events[a]:this._events={},this):this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.EventEmitter=d,d.EventEmitter2=d,d.EventEmitter3=d,b.exports=d},{}],2:[function(a,b){"use strict";var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function i(a,b,c){var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:i(e,b,c)}if("value"in d&&d.writable)return d.value;var f=d.get;return void 0===f?void 0:f.call(c)},e=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},f=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},g=a("./Publisher"),h=function(a){function b(){var a=void 0===arguments[0]?{}:arguments[0];f(this,b),d(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.asyncResult=!!a.asyncResult,this.children=a.children||[],this.asyncResult&&this.children.push("completed","failed"),a.preEmit&&(this.preEmit=a.preEmit),a.shouldEmit&&(this.shouldEmit=a.shouldEmit),this.createChildActions();var c=a.sync?this.triggerSync:this.trigger,e=c.bind(this);return e.__proto__=this,e}return e(b,a),c(b,{eventType:{get:function(){return"event"}},isAction:{get:function(){return!0}},createChildActions:{value:function(){var a=this;this.children.forEach(function(c){return a[c]=new b({actionType:c})})}}}),b}(g);b.exports=h},{"./Publisher":5}],3:[function(a,b){"use strict";var c=function(a,b){var c=Object.create(a.prototype),d=a.apply(c,b);return null==d||"object"!=typeof d&&"function"!=typeof d?c:d},d=Array.prototype.slice,e=function m(a,b,c){var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:m(e,b,c)}if("value"in d&&d.writable)return d.value;var f=d.get;return void 0===f?void 0:f.call(c)},f=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},g=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},h=a("./Store"),i=function(a){function b(){g(this,b),e(Object.getPrototypeOf(b.prototype),"constructor",this).call(this);var a=[].concat(d.call(arguments),["trigger"]);this.joinStrict.apply(this,a)}return f(b,a),b}(h),j=function(a){function b(){g(this,b),e(Object.getPrototypeOf(b.prototype),"constructor",this).call(this);var a=[].concat(d.call(arguments),["trigger"]);this.joinLeading.apply(this,a)}return f(b,a),b}(h),k=function(a){function b(){g(this,b),e(Object.getPrototypeOf(b.prototype),"constructor",this).call(this);var a=[].concat(d.call(arguments),["trigger"]);this.joinTrailing.apply(this,a)}return f(b,a),b}(h),l=function(a){function b(){g(this,b),e(Object.getPrototypeOf(b.prototype),"constructor",this).call(this);var a=[].concat(d.call(arguments),["trigger"]);this.joinConcat.apply(this,a)}return f(b,a),b}(h);b.exports={JoinStrict:function(){return c(i,d.call(arguments))},JoinLeading:function(){return c(j,d.call(arguments))},JoinTrailing:function(){return c(k,d.call(arguments))},JoinConcat:function(){return c(l,d.call(arguments))}}},{"./Store":6}],4:[function(a,b){"use strict";var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function m(a,b,c){var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:m(e,b,c)}if("value"in d&&d.writable)return d.value;var f=d.get;return void 0===f?void 0:f.call(c)},e=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},f=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},g=a("./utils"),h=a("./Publisher"),i=a("./instanceJoinCreator"),j=function(a){function b(){f(this,b),d(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.subscriptions=[]}return e(b,a),c(b,{hasListener:{value:function(a){for(var b=this.subscriptions||[],c=0;c<b.length;++c)for(var d=[].concat(b[c].listenable),e=0;e<d.length;++e){var f=d[e];if(f===a)return!0;if(f.hasListener&&f.hasListener(a))return!0}return!1}},listenToMany:{value:function(a){var b=l(a);for(var c in b){var d=g.callbackName(c),e=this[d]?d:this[c]?c:void 0;if(e){var f=this[d+"Default"]||this[e+"Default"]||e;this.listenTo(b[c],e,f)}}}},validateListening:{value:function(a){return a===this?"Listener is not able to listen to itself":g.isFunction(a.listen)?a.hasListener&&a.hasListener(this)?"Listener cannot listen to this listenable because of circular loop":void 0:a+" is missing a listen method"}},listenTo:{value:function(a,b,c){g.throwIf(this.validateListening(a)),this.fetchInitialState(a,c);var d=this.subscriptions,e=a.listen(this[b]||b,this),f=function(){var a=d.indexOf(h);g.throwIf(-1===a,"Tried to remove listen already gone from subscriptions list!"),d.splice(a,1),e()},h={stop:f,listenable:a};return d.push(h),h}},stopListeningTo:{value:function(a){for(var b=this.subscriptions||[],c=0;c<b.length;++c){var d=b[c];if(d.listenable===a)return d.stop(),g.throwIf(-1!==b.indexOf(d),"Failed to remove listen from subscriptions list!"),!0}return!1}},stopListeningToAll:{value:function(){for(var a,b=this.subscriptions||[];a=b.length;)b[0].stop(),g.throwIf(b.length!==a-1,"Failed to remove listen from subscriptions list!")}},fetchInitialState:{value:function(a,b){"string"==typeof b&&(b=this[b]);var c=this;if(g.isFunction(b)&&a.state){var d=a.state;d&&g.isFunction(d.then)?d.then(function(){b.apply(c,arguments)}):b.call(this,d)}}}}),b}(h);j.prototype.joinTrailing=i("last"),j.prototype.joinLeading=i("first"),j.prototype.joinConcat=i("all"),j.prototype.joinStrict=i("strict");var k=function(a){for(var b={},c=a.children||[],d=0;d<c.length;++d){var e=c[d];a[e]&&(b[e]=a[e])}return b},l=function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(a){var b={};for(var c in a){var d=a[c],e=k(d),f=l(e);b[c]=d;for(var h in f){var i=f[h];b[c+g.capitalize(h)]=i}}return b});b.exports=j},{"./Publisher":5,"./instanceJoinCreator":8,"./utils":9}],5:[function(a,b){"use strict";var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},e=a("./utils"),f=function(){function a(){d(this,a),this.emitter=new e.EventEmitter,this.children=[],this.dispatchPromises_=[]}return c(a,{eventType:{get:function(){return"event"}},isPublisher:{get:function(){return!0}},preEmit:{value:function(){}},shouldEmit:{value:function(){return!0}},listen:{value:function(b,c){var d=this,f=!1;c=c||this;var g=function(g){if(!f){var h=b.apply(c,g);if(e.isPromise(h)){var i=a.prototype.canHandlePromise.call(d);if(!i)return void console.warn("Unhandled promise for "+d.eventType);d.dispatchPromises_.push({promise:h,listener:b})}}};return this.emitter.addListener(this.eventType,g),function(){f=!0,d.emitter.removeListener(d.eventType,g)}}},listenOnce:{value:function(a,b){b=b||this;var c=this.listen(function(){var d=Array.prototype.slice.call(arguments);return c(),a.apply(b,d)});return c}},promise:{value:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(a){var b=this,c=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0;if(!c)throw new Error('Publisher must have "completed" and "failed" child publishers');a.then(function(a){return b.completed(a)})["catch"](function(a){return b.failed(a)})})},fetchJson:{value:function(a){var b=this,c=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0;if(!c)throw new Error('Publisher must have "completed" and "failed" child publishers');a.then(function(a){return a.json()}).then(this.completed)["catch"](function(a){return b.failed(a)})}},listenAndPromise:{value:function(a,b){var c=this;b=b||this,this.willCallPromise=(this.willCallPromise||0)+1;var d=this.listen(function(){if(!a)throw new Error("Expected a function returning a promise but got "+a);var d=arguments,e=a.apply(b,d);return c.promise.call(c,e)},b);return function(){c.willCallPromise--,d.call(c)}}},listenAndFetchJson:{value:function(a,b){var c=this;b=b||this,this.willCallPromise=(this.willCallPromise||0)+1;var d=this.listen(function(){if(!a)throw new Error("Expected a function returning a promise but got "+a);var d=arguments,e=a.apply(b,d);return c.fetchJson.call(c,e)},b);return function(){c.willCallPromise--,d.call(c)}}},resolve:{value:function(b){var c=a.prototype.canHandlePromise.call(this);if(!c)throw new Error("Not an async publisher");if(!e.isPromise(b))return void this.completed.trigger(b);var d=this;b.then(function(a){return d.completed.trigger(a)},function(a){return d.failed.trigger(a)})}},reject:{value:function(a){return e.isPromise(a)?void console.warn("Use #resolve() for promises."):void this.failed.trigger(a)}},then:{value:function(b,c){var d=a.prototype.canHandlePromise.call(this);if(!d)throw new Error("Not an async publisher");b&&this.completed.listenOnce(b),c&&this.failed.listenOnce(c)}},"catch":{value:function(a){this.then(null,a)}},canHandlePromise:{value:function(){return this.completed&&this.failed&&this.completed.isPublisher&&this.failed.isPublisher}},triggerSync:{value:function(){var b=arguments,c=this.preEmit.apply(this,b);"undefined"!=typeof c&&(b=e.isArguments(c)?c:[].concat(c)),this.shouldEmit.apply(this,b)&&(this.dispatchPromises_=[],this.emitter.emit(this.eventType,b),a.prototype._handleDispatchPromises.call(this))}},trigger:{value:function(){var a=arguments,b=this;e.nextTick(function(){b.triggerSync.apply(b,a)})}},triggerPromise:{value:function(){var b=a.prototype.canHandlePromise.call(this);if(!b)throw new Error('Publisher must have "completed" and "failed" child publishers');var c=this,d=arguments,f=e.createPromise(function(a,b){var e=c.completed.listen(function(b){e(),f(),a(b)}),f=c.failed.listen(function(a){e(),f(),b(a)});c.trigger.apply(c,d)});return f}},_handleDispatchPromises:{value:function(){var a=this.dispatchPromises_;if(this.dispatchPromises_=[],0!==a.length){if(1===a.length)return this.resolve(a[0].promise);var b=a.map(function(a){return a.promise.then(function(b){return{listener:a.listener,value:b}})}),c=e.Promise.all(b);return this.resolve(c)}}}}),a}();b.exports=f},{"./utils":9}],6:[function(a,b){"use strict";var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function i(a,b,c){var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:i(e,b,c)}if("value"in d&&d.writable)return d.value;var f=d.get;return void 0===f?void 0:f.call(c)},e=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},f=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},g=a("./Listener"),h=function(a){function b(){f(this,b),d(Object.getPrototypeOf(b.prototype),"constructor",this).call(this)}return e(b,a),c(b,{eventType:{get:function(){return"change"}},publishState:{value:function(){d(Object.getPrototypeOf(b.prototype),"trigger",this).call(this,this.state)}}}),b}(g);b.exports=h},{"./Listener":4}],7:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./JoinStores");c.Action=a("./Action"),c.Listener=a("./Listener"),c.Publisher=a("./Publisher"),c.Store=a("./Store"),c.joinTrailing=c.all=e.JoinTrailing,c.joinLeading=e.JoinLeading,c.joinStrict=e.JoinStrict,c.joinConcat=e.JoinConcat,c.EventEmitter=d.EventEmitter,c.Promise=d.Promise,c.setEventEmitter=function(b){var d=a("./utils");c.EventEmitter=d.EventEmitter=b},c.setPromise=function(b){var d=a("./utils");c.Promise=d.Promise=b},c.setPromiseFactory=function(b){var c=a("./utils");c.createPromise=b},c.nextTick=function(b){var c=a("./utils");c.nextTick=b},Function.prototype.bind||console.error("Function.prototype.bind not available. ES5 shim required. https://github.com/jankuca/airflux#es5")},{"./Action":2,"./JoinStores":3,"./Listener":4,"./Publisher":5,"./Store":6,"./utils":9}],8:[function(a,b){"use strict";function c(a,b,c){return function(){var d,e=c.subscriptions,f=e?e.indexOf(a):-1;for(g.throwIf(-1===f,"Tried to remove join already gone from subscriptions list!"),d=0;d<b.length;++d)b[d]();e.splice(f,1)}}function d(a){a.listenablesEmitted=new Array(a.numberOfListenables),a.args=new Array(a.numberOfListenables)}function e(a,b){return function(){var c=h.call(arguments);if(b.listenablesEmitted[a])switch(b.strategy){case"strict":throw new Error("Strict join failed because listener triggered twice.");case"last":b.args[a]=c;break;case"all":b.args[a].push(c)}else b.listenablesEmitted[a]=!0,b.args[a]="all"===b.strategy?[c]:c;f(b)}}function f(a){for(var b=0;b<a.numberOfListenables;++b)if(!a.listenablesEmitted[b])return;a.callback.apply(a.listener,a.args),d(a)}var g=a("./utils"),h=Array.prototype.slice;b.exports=function(a){return function(){g.throwIf(arguments.length<3,"Cannot create a join with less than 2 listenables!");var b,f=h.call(arguments),i=f.pop(),j=f.length,k={numberOfListenables:j,callback:this[i]||i,listener:this,strategy:a},l=[];for(b=0;j>b;++b)g.throwIf(this.validateListening(f[b]));for(b=0;j>b;++b)l.push(f[b].listen(e(b,k),this));d(k);var m={listenable:f};return m.stop=c(m,l,this),this.subscriptions=(this.subscriptions||[]).concat(m),m}}},{"./utils":9}],9:[function(a,b,c){"use strict";c.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a};c.isFunction=function(a){return"function"==typeof a},c.isPromise=function(a){return a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then},c.EventEmitter=a("eventemitter3"),c.nextTick=function(a){setTimeout(a,0)},c.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},c.callbackName=function(a){return"on"+c.capitalize(a)},c.object=function(a,b){for(var c={},d=0;d<a.length;d++)c[a[d]]=b[d];return c},c.Promise=Promise,c.createPromise=function(a){return new c.Promise(a)},c.isArguments=function(a){return"object"==typeof a&&"callee"in a&&"number"==typeof a.length},c.throwIf=function(a,b){if(a)throw Error(b||a)}},{eventemitter3:1}]},{},[7])(7)});